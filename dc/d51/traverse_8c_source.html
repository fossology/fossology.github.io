<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FOSSology: src/ununpack/agent/traverse.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../fossology-logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FOSSology
   &#160;<span id="projectnumber">4.6.0-rc1</span>
   </div>
   <div id="projectbrief">Open Source License Compliance by Open Source Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc/d51/traverse_8c_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">traverse.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/d51/traverse_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> SPDX-FileCopyrightText: Â© 2011 Hewlett-Packard Development Company, L.P.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> SPDX-License-Identifier: GPL-2.0-only</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;ununpack.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/df2/externs_8h.html">externs.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="../../dc/d51/traverse_8c.html#a046fc4e1094b61c75af58061b57a6d64">   24</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d51/traverse_8c.html#a046fc4e1094b61c75af58061b57a6d64">TraverseStart</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, <span class="keywordtype">char</span> *Label, <span class="keywordtype">char</span> *<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>, <span class="keywordtype">char</span> *ExcludePatterns)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="../../df/d8d/structdirlist.html">dirlist</a> *DLhead, *DLentry;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">char</span> Name[FILENAME_MAX];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordtype">char</span> *Basename; <span class="comment">/* the filename without the path */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="../../d3/dbf/structParentInfo.html">ParentInfo</a> PI;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  PI.Cmd = 0;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  PI.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a> = time(NULL);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  PI.<a class="code" href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">EndTime</a> = PI.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  PI.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = 0;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  Basename = strrchr(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,<span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">if</span> (Basename) Basename++;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">else</span> Basename = <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  memset(<a class="code" href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a>,<span class="charliteral">&#39;\0&#39;</span>,MAXSQL);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#aff24afc956c8b7c00247758f99b2c55d">IsDir</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>))</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    memset(Name,<span class="charliteral">&#39;\0&#39;</span>,<span class="keyword">sizeof</span>(Name));</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    strcpy(Name,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,Basename,Label,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>,&amp;PI,ExcludePatterns);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">else</span> <span class="comment">/* process directory */</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    DLhead = <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#aee9a4674a7cf791d89b2cd3133867ad5">MakeDirList</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span>(DLentry=DLhead; DLentry; DLentry=DLentry-&gt;<a class="code" href="../../df/d8d/structdirlist.html#a0a4355653fb6ded7a8f9736fc157a2a4">Next</a>)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="comment">/* Now process the filename */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      memset(Name,<span class="charliteral">&#39;\0&#39;</span>,<span class="keyword">sizeof</span>(Name));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      strcpy(Name,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="keywordflow">if</span> (Last(Name) != <span class="charliteral">&#39;/&#39;</span>) strcat(Name,<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      strcat(Name,DLentry-&gt;Name);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="../../dc/d51/traverse_8c.html#a046fc4e1094b61c75af58061b57a6d64">TraverseStart</a>(Name,Label,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>, ExcludePatterns);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a8cae8a17fc2bf4506f01b1fe34a27ae7">FreeDirList</a>(DLhead);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">/* remove anything that we needed to create */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#ab9155734cbe51b26d62afa66f5952db8">UnlinkAll</a>)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">struct </span>stat <a class="code" href="../../d2/d7b/test__CopyFile_8c.html#af16413f3af1abd6bf7646374bf12f672">Src</a>,<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#ab9e3da739cc5709282a49940edec2d6b">Dst</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">/* build the destination name */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a55da88b45401fd659b99672a6d7bc063">SetDir</a>(Name,<span class="keyword">sizeof</span>(Name),<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,Basename);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">for</span>(i=strlen(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>)-1; (i&gt;=0) &amp;&amp; (<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>[i] != <span class="charliteral">&#39;/&#39;</span>); i--)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      ;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (strcmp(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>+i+1,<span class="stringliteral">&quot;.&quot;</span>)) strcat(Name,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>+i+1);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    lstat(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,&amp;<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#af16413f3af1abd6bf7646374bf12f672">Src</a>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    lstat(Name,&amp;<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#ab9e3da739cc5709282a49940edec2d6b">Dst</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    printf(<span class="stringliteral">&quot;End:\n&quot;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    printf(<span class="stringliteral">&quot;  Src: %ld %s\n&quot;</span>,(<span class="keywordtype">long</span>)<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#af16413f3af1abd6bf7646374bf12f672">Src</a>.st_ino,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    printf(<span class="stringliteral">&quot;  Dst: %ld %s\n&quot;</span>,(<span class="keywordtype">long</span>)<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#ab9e3da739cc5709282a49940edec2d6b">Dst</a>.st_ino,Name);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">/* only delete them if they are different!  (Different inodes) */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7b/test__CopyFile_8c.html#af16413f3af1abd6bf7646374bf12f672">Src</a>.st_ino != <a class="code" href="../../d2/d7b/test__CopyFile_8c.html#ab9e3da739cc5709282a49940edec2d6b">Dst</a>.st_ino)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#aff24afc956c8b7c00247758f99b2c55d">IsDir</a>(Name)) rmdir(Name);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">else</span> unlink(Name);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  } <span class="comment">/* if UnlinkAll */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;} <span class="comment">/* TraverseStart() */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="../../dc/d51/traverse_8c.html#a85f808829ada5223b092deca6de501c6">   96</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="../../dc/d51/traverse_8c.html#a85f808829ada5223b092deca6de501c6">TraverseChild</a> (<span class="keywordtype">int</span> Index, <a class="code" href="../../d8/db7/structContainerInfo.html">ContainerInfo</a> *CI, <span class="keywordtype">char</span> *<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">int</span> PlainCopy=0;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  cmdtype Type;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  Type = <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">Type</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a3afc29fb861af74db4407d373adab9df">Status</a> == 0) Type=CMD_DEFAULT;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">switch</span>(Type)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">case</span> CMD_PACK:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a3300195cb6a40044a95f2b04f3e27c29">TopContainer</a> &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#a0e1e0eb803a25bb515c8560260161fcf">UseRepository</a>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a6e479dbd33c75d4a9638fd6b2834f0b3">RemovePostfix</a>(<a class="code" href="../../d2/df2/externs_8h.html#a9065b9f1c1715bc048058d9bb8263a8f">UploadFileName</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        memcpy(CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>, <a class="code" href="../../d2/df2/externs_8h.html#a9065b9f1c1715bc048058d9bb8263a8f">UploadFileName</a>, <span class="keyword">sizeof</span>(CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>));</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>[<span class="keyword">sizeof</span>(CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>)-1] = 0;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a6e479dbd33c75d4a9638fd6b2834f0b3">RemovePostfix</a>(CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a6e479dbd33c75d4a9638fd6b2834f0b3">RemovePostfix</a>(CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="comment">/* unpack in a sub-directory */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      rc=<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0688c932b008471183a29139b4f95678">RunCommand</a>(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#ae923a3cb4c42188ac5441cc4d7dd6252">CmdPre</a>,CI-&gt;Source,</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#aca62b31c4db91db7d4bcb0b83e72c300">CmdPost</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">case</span> CMD_RPM:</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="comment">/* unpack in the current directory */</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      rc=<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0688c932b008471183a29139b4f95678">RunCommand</a>(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#ae923a3cb4c42188ac5441cc4d7dd6252">CmdPre</a>,CI-&gt;Source,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#aca62b31c4db91db7d4bcb0b83e72c300">CmdPost</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">case</span> CMD_ARC:</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">case</span> CMD_PARTITION:</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="comment">/* unpack in a sub-directory */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      rc=<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0688c932b008471183a29139b4f95678">RunCommand</a>(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#ae923a3cb4c42188ac5441cc4d7dd6252">CmdPre</a>,CI-&gt;Source,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#aca62b31c4db91db7d4bcb0b83e72c300">CmdPost</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].Magic,<span class="stringliteral">&quot;application/x-zip&quot;</span>) &amp;&amp;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          ((rc==1) || (rc==2) || (rc==51)) )</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        LOG_WARNING(<span class="stringliteral">&quot;pfile %s Minor zip error(%d)... ignoring error.&quot;</span>,<a class="code" href="../../d2/df2/externs_8h.html#a06bdfab0e4aebb0f085344b9af5d4f79">Pfile_Pk</a>,rc)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        rc=0; <span class="comment">/* lots of zip return codes */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">case</span> CMD_AR:</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="comment">/* unpack an AR: source file and destination directory */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      rc=<a class="code" href="../../da/dc9/ununpack-ar_8c.html#ae9b5ed248989dc8062b9f7f13d153f7a">ExtractAR</a>(CI-&gt;Source,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">case</span> CMD_ISO:</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">/* unpack an ISO: source file and destination directory */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      rc=<a class="code" href="../../d7/df3/ununpack-iso_8c.html#a44bb9c4d80d984b566d5e3623abfdf41">ExtractISO</a>(CI-&gt;Source,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">case</span> CMD_DISK:</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="comment">/* unpack a DISK: source file, FS type, and destination directory */</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      rc=<a class="code" href="../../dd/df0/ununpack-disk_8c.html#a45f3002c753d25020be58733213ce62c">ExtractDisk</a>(CI-&gt;Source,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">case</span> CMD_DEB:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="comment">/* unpack a DEBIAN source:*/</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      rc=<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0688c932b008471183a29139b4f95678">RunCommand</a>(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#ae923a3cb4c42188ac5441cc4d7dd6252">CmdPre</a>,CI-&gt;Source,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#aca62b31c4db91db7d4bcb0b83e72c300">CmdPost</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">case</span> CMD_ZSTD:</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="comment">/* unpack a ZSTD: source file, source name and destination directory */</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      rc = <a class="code" href="../../dd/de8/ununpack-zstd_8c.html#aff5a2738c264d906825abe7eacefcb7e">ExtractZstd</a>(CI-&gt;Source, CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>, <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">case</span> CMD_DEFAULT:</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="comment">/* use the original name */</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      PlainCopy=1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d72/wc__agent_8c.html#a22009aec802ada7c638401a40d40775c">IsFile</a>(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,0))</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="../../d1/da6/repcopyin_8c.html#a16ebffeb9cbd186c1170f284e719dbb3">CopyFile</a>(CI-&gt;Source,<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">ChildRecurse</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      rc=0;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  } <span class="comment">/* switch type of processing */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">/* Child: Unpacks */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">/* remove source */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a1d4b244022f10811f764dfa2691a3f60">UnlinkSource</a> &amp;&amp; (rc==0) &amp;&amp; !<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> &amp;&amp; !PlainCopy)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">/* if we&#39;re unlinking AND command worked AND it&#39;s not original... */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    unlink(CI-&gt;Source);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">if</span> (rc)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">/* if command failed but we want to continue anyway */</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">/* Note: CMD_DEFAULT will never get here because rc==0 */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span> (strstr(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>, <span class="stringliteral">&quot;unzip&quot;</span>) &amp;&amp; (rc == 82))</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      LOG_ERROR(<span class="stringliteral">&quot;pfile %s Command %s failed on: %s, Password required.&quot;</span>,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a06bdfab0e4aebb0f085344b9af5d4f79">Pfile_Pk</a>, <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>, CI-&gt;Source);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      LOG_ERROR(<span class="stringliteral">&quot;pfile %s Command %s failed on: %s&quot;</span>,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a06bdfab0e4aebb0f085344b9af5d4f79">Pfile_Pk</a>, <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI-&gt;<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">Cmd</a>, CI-&gt;Source);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#afbe2b0bbc145212ed3974fcdd2eb207a">ForceContinue</a>) rc=-1;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  exit(rc);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;} <span class="comment">/* TraverseChild() */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../dc/d51/traverse_8c.html#a5a0ed04e29704b6829ae0f4533cf4ebb">  238</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d51/traverse_8c.html#a5a0ed04e29704b6829ae0f4533cf4ebb">CountFilename</a>(<span class="keywordtype">char</span> *Pathname, <span class="keywordtype">char</span> *Dirname)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">char</span> *FullDirname;  </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordtype">char</span> *sp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordtype">int</span>   FoundCount = 0;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">int</span>   NameLen;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  FullDirname = calloc(strlen(Dirname) + 3, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  sprintf(FullDirname, <span class="stringliteral">&quot;/%s/&quot;</span>, Dirname);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  NameLen = strlen(FullDirname);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  sp = Pathname;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">while</span> (((sp = strstr(sp, FullDirname)) != NULL))</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    FoundCount++;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    sp += NameLen;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  free(FullDirname);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">return</span>(FoundCount);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">  275</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a>  (<span class="keywordtype">char</span> *<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, <span class="keywordtype">char</span> *Basename,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">char</span> *Label, <span class="keywordtype">char</span> *<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>, <a class="code" href="../../d3/dbf/structParentInfo.html">ParentInfo</a> *PI, <span class="keywordtype">char</span> *ExcludePatterns)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ace54f405f5bb845211785673bf1f730c">ShouldExclude</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, ExcludePatterns)) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/de7/delagent_2agent_2util_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a>) LOG_DEBUG(<span class="stringliteral">&quot;Skipping excluded file or folder: %s&quot;</span>, <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  PGresult *result;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="../../d8/db7/structContainerInfo.html">ContainerInfo</a> CI,CImeta;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">int</span> IsContainer=0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">int</span> RecurseOk=1;  <span class="comment">/* should it recurse? (only on unique inserts) */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">int</span> MaxRepeatingName = 3;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a> || (<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>[0]==<span class="charliteral">&#39;\0&#39;</span>)) <span class="keywordflow">return</span>(IsContainer);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/de7/delagent_2agent_2util_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a> &gt; 0) LOG_DEBUG(<span class="stringliteral">&quot;Traverse(%s) -- %s&quot;</span>,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,Label)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">/* to prevent infinitely recursive test archives, count how many times the basename</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">     occurs in Filename.  If over MaxRepeatingName, then return 0</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dc/d51/traverse_8c.html#a5a0ed04e29704b6829ae0f4533cf4ebb">CountFilename</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, basename(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>)) &gt;= MaxRepeatingName)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    LOG_NOTICE(<span class="stringliteral">&quot;Traverse() recursion terminating due to max directory repetition: %s&quot;</span>, <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">/* clear the container */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  memset(&amp;CI,0,<span class="keyword">sizeof</span>(<a class="code" href="../../d8/db7/structContainerInfo.html">ContainerInfo</a>));</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">/* check for top containers */</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a3300195cb6a40044a95f2b04f3e27c29">TopContainer</a> = (<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>!=NULL);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">/* Populate CI and CI.PI structure */</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd=PI-&gt;Cmd;  <span class="comment">/* inherit */</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a> = PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">EndTime</a> = PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">EndTime</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a0fb8f628d00d1b4b3765f22799321f15">Artifact</a> = PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">/* the item is processed; log all children */</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">if</span> (CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a0fb8f628d00d1b4b3765f22799321f15">Artifact</a> &gt; 0) PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>=CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a0fb8f628d00d1b4b3765f22799321f15">Artifact</a>-1;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">else</span> PI-&gt;<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>=0;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  rc = lstat(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,&amp;CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">/* Source filename may be from another Queue element.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">     Copy the name over so it does not accidentally change. */</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  strcpy(CI.Source,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">/* split directory and filename */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (Basename) <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a55da88b45401fd659b99672a6d7bc063">SetDir</a>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,<span class="keyword">sizeof</span>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>),<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,Basename);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">else</span> <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a55da88b45401fd659b99672a6d7bc063">SetDir</a>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,<span class="keyword">sizeof</span>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>),<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,CI.Source);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">/* count length of filename */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">for</span>(i=strlen(CI.Source)-1; (i&gt;=0) &amp;&amp; (CI.Source[i] != <span class="charliteral">&#39;/&#39;</span>); i--)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    ;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  strcpy(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>,CI.Source+i+1);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  strcpy(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">/* ignore anything that is not a directory or a file */</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">if</span> (CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode &amp; S_IFMT &amp; ~(S_IFREG | S_IFDIR))</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (PI-&gt;Cmd) <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CI,PI-&gt;Cmd);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">goto</span> TraverseEnd;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (rc != 0)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">/* this should never happen... */</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    LOG_ERROR(<span class="stringliteral">&quot;pfile %s \&quot;%s\&quot; DOES NOT EXIST!!!&quot;</span>,<a class="code" href="../../d2/df2/externs_8h.html#a06bdfab0e4aebb0f085344b9af5d4f79">Pfile_Pk</a>,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">/* goto TraverseEnd; */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">/* handle pruning (on recursion only -- never delete originals) */</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a8a79461093fd4ed01d5a021a4fc7c66f">PruneFiles</a> &amp;&amp; !<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> &amp;&amp; <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a2020639c7c03622a929b1cc72d9a06fb">Prune</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">/* pruned! */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (PI-&gt;Cmd)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a77b8b029763ac83e763135a6554a88b5">Pruned</a>=1;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CI,PI-&gt;Cmd);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">goto</span> TraverseEnd;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">/* check the type of file in filename: file or directory */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (S_ISDIR(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode))</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">    /***********************************************/</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">/* if it&#39;s a directory, then recurse! */</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    /***********************************************/</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="../../df/d8d/structdirlist.html">dirlist</a> *DLhead, *DLentry;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordtype">long</span> TmpPk;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">/* record stats */</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a061e6987f5563a6fd0aa98822bda4db0">IsDir</a>=1;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>=1;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    IsContainer=1;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">/* make sure it is accessible */</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> &amp;&amp; ((CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode &amp; 0700) != 0700))</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      chmod(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode | 0700));</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span> (CI.Source[strlen(CI.Source)-1] != <span class="charliteral">&#39;/&#39;</span>) strcat(CI.Source,<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    DLhead = <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#aee9a4674a7cf791d89b2cd3133867ad5">MakeDirList</a>(CI.Source);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">/* process inode in the directory (only if unique) */</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CI,PI-&gt;Cmd))</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">for</span>(DLentry=DLhead; DLentry; DLentry=DLentry-&gt;<a class="code" href="../../df/d8d/structdirlist.html#a0a4355653fb6ded7a8f9736fc157a2a4">Next</a>)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a55da88b45401fd659b99672a6d7bc063">SetDir</a>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,<span class="keyword">sizeof</span>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>),<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>,CI.Source);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        strcat(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,DLentry-&gt;Name);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        TmpPk = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a891fad50d559c4e862f50f955bc5a84e">uploadtree_pk</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">/* don&#39;t decrement just because it is a directory */</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <a class="code" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a>(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,NULL,<span class="stringliteral">&quot;Called by dir&quot;</span>,NULL,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>,&amp;(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>), ExcludePatterns);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = TmpPk;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (PI-&gt;Cmd &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      fputs(<span class="stringliteral">&quot;&lt;/item&gt;\n&quot;</span>,<a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a8cae8a17fc2bf4506f01b1fe34a27ae7">FreeDirList</a>(DLhead);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  } <span class="comment">/* if S_ISDIR() */</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (S_ISLNK(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode) || S_ISCHR(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode) ||</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      S_ISBLK(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode) || S_ISFIFO(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode) ||</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      S_ISSOCK(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode))</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">/* skip symbolic links, blocks, and special devices */</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (S_ISREG(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode))</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ad3f39d9f28b78932107203b1e6250828">IsInflatedFile</a>(CI.Source, 1000)) <span class="keywordflow">return</span> 0; <span class="comment">// if the file is one compression bombs, do not unpack this file</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">    /***********************************************/</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">/* if it&#39;s a regular file, then process it! */</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">    /***********************************************/</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">int</span> Pid;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">int</span> Index;  <span class="comment">/* child index into queue table */</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd = <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#acc07c877878c2fb76b859399bdab6e3a">FindCmd</a>(CI.Source);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd &lt; 0) <span class="keywordflow">goto</span> TraverseEnd;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">/* make sure it is accessible */</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> &amp;&amp; ((CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode &amp; 0600) != 0600))</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      chmod(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>,(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>.st_mode | 0600));</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">/* if it made it this far, then it&#39;s spawning time! */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">/* Determine where to put the output */</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    Index=0;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">while</span>((Index &lt; MAXCHILD) &amp;&amp; (<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildPid != 0))</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      Index++;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">/* determine output location */</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    memset(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>+Index,0,<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d06/structunpackqueue.html">unpackqueue</a>)); <span class="comment">/* clear memory */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    strcpy(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    strcat(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a5658af09fefa20ae5a0a3ac94067c281">ChildEnd</a>=0;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.Cmd = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a2fbb06cc24e648b4ad39c31247428c64">ChildStat</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">Type</a>)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">case</span> CMD_ARC:</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">case</span> CMD_AR:</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordflow">case</span> CMD_ISO:</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">case</span> CMD_DISK:</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">case</span> CMD_PARTITION:</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">case</span> CMD_PACK:</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">case</span> CMD_ZSTD:</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>=1;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        IsContainer=1;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        strcat(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,<span class="stringliteral">&quot;.dir&quot;</span>);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        strcat(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,<span class="stringliteral">&quot;.dir&quot;</span>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>=1;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="comment">/* make the directory */</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a448bdbe43cd0c6546080a43d040d6459">MkDir</a>(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse))</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;          LOG_FATAL(<span class="stringliteral">&quot;Unable to mkdir(%s) in Traverse&quot;</span>, <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="../../d2/df2/externs_8h.html#afbe2b0bbc145212ed3974fcdd2eb207a">ForceContinue</a>)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ac78bfb98ca0076b2346b17dbcdb2d018">SafeExit</a>(30);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">Type</a> == CMD_PARTITION)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>=2;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="comment">/* get the upload file name */</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="comment">/* if the type of the upload file is CMD_PACK, and is top container,</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">         * and using repository, then get the upload file name from DB</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">if</span> (CMD_PACK == <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">Type</a> &amp;&amp; CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a3300195cb6a40044a95f2b04f3e27c29">TopContainer</a> &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#a0e1e0eb803a25bb515c8560260161fcf">UseRepository</a>)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <span class="keywordtype">char</span> *UFileName;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          <span class="keywordtype">char</span> <a class="code" href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a>[MAXSQL];</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          snprintf(<a class="code" href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a>, MAXSQL,<span class="stringliteral">&quot;SELECT upload_filename FROM upload WHERE upload_pk = %s;&quot;</span>,<a class="code" href="../../d2/df2/externs_8h.html#a96101cadb5f5bcad1215b7c40600e03e">Upload_Pk</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;          result =  PQexec(<a class="code" href="../../dd/d9a/adj2nest_8c.html#a7444694163584e990af192a7b4f9dddc">pgConn</a>, <a class="code" href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a>);  <span class="comment">// get name of the upload file</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d1/d54/libfossdb_8c.html#a438acf56cee347de51d91e1afe2de97d">fo_checkPQresult</a>(<a class="code" href="../../dd/d9a/adj2nest_8c.html#a7444694163584e990af192a7b4f9dddc">pgConn</a>, result, <a class="code" href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a>, __FILE__, __LINE__))</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ac78bfb98ca0076b2346b17dbcdb2d018">SafeExit</a>(31);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          UFileName = PQgetvalue(result,0,0);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          PQclear(result);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          <span class="keywordflow">if</span> (strchr(UFileName, <span class="charliteral">&#39;/&#39;</span>)) UFileName = strrchr(UFileName, <span class="charliteral">&#39;/&#39;</span>) + 1;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          memset(<a class="code" href="../../d2/df2/externs_8h.html#a9065b9f1c1715bc048058d9bb8263a8f">UploadFileName</a>, <span class="charliteral">&#39;\0&#39;</span>, FILENAME_MAX);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          strncpy(<a class="code" href="../../d2/df2/externs_8h.html#a9065b9f1c1715bc048058d9bb8263a8f">UploadFileName</a>, UFileName, FILENAME_MAX - 1);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">case</span> CMD_DEB:</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">case</span> CMD_RPM:</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>=1;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        IsContainer=1;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        strcat(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,<span class="stringliteral">&quot;.unpacked&quot;</span>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        strcat(CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">PartnameNew</a>,<span class="stringliteral">&quot;.unpacked&quot;</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ChildRecurseArtifact</a>=1;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">Type</a> == CMD_PACK)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a16753df28705ba45c82870227e33b3a0">IsCompressed</a> = 1;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">case</span> CMD_DEFAULT:</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">/* use the original name */</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>=0;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a5658af09fefa20ae5a0a3ac94067c281">ChildEnd</a>=1;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a983502a85b09cc9d038adb6791de67dd">ChildHasChild</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">/* save the file&#39;s data */</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    RecurseOk = <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CI,PI-&gt;Cmd);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">/* extract meta info if we added it */</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (RecurseOk &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a52152df8214439058f322d1df401bd46">MetaCmd</a> &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a52152df8214439058f322d1df401bd46">MetaCmd</a>[0])</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="comment">/* extract meta info */</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">/* This needs to call AddToRepository() or DisplayContainerInfo() */</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordtype">char</span> Cmd[2*FILENAME_MAX];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordtype">char</span> Fname[FILENAME_MAX];</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      memcpy(&amp;CImeta,&amp;CI,<span class="keyword">sizeof</span>(CI));</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#a0fb8f628d00d1b4b3765f22799321f15">Artifact</a>=1;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a>=0;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#a3300195cb6a40044a95f2b04f3e27c29">TopContainer</a> = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a891fad50d559c4e862f50f955bc5a84e">uploadtree_pk</a>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd = 0; <span class="comment">/* no meta type */</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      memset(Cmd,0,<span class="keyword">sizeof</span>(Cmd));</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      memset(Fname,0,<span class="keyword">sizeof</span>(Fname));</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      strcpy(Fname,CImeta.Source);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      strcat(CImeta.Source,<span class="stringliteral">&quot;.meta&quot;</span>);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      strcat(CImeta.<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>,<span class="stringliteral">&quot;.meta&quot;</span>);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="comment">/* remove the destination file if it exists */</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="comment">/* this gets past any permission problems with read-only files */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      unlink(CImeta.Source);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">/* build the command and run it */</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      sprintf(Cmd,<a class="code" href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a>[CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.Cmd].<a class="code" href="../../d4/d71/structcmdlist.html#a52152df8214439058f322d1df401bd46">MetaCmd</a>,Fname,CImeta.Source);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      rc = system(Cmd);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">if</span> (WIFSIGNALED(rc))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        LOG_ERROR(<span class="stringliteral">&quot;Process killed by signal (%d): %s&quot;</span>,WTERMSIG(rc),Cmd)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ac78bfb98ca0076b2346b17dbcdb2d018">SafeExit</a>(32);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">if</span> (WIFEXITED(rc)) rc = WEXITSTATUS(rc);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">else</span> rc=-1;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">if</span> (rc != 0) LOG_ERROR(<span class="stringliteral">&quot;Unable to run command &#39;%s&#39;&quot;</span>,Cmd)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="comment">/* add it to the list of files */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      RecurseOk = <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CImeta,PI-&gt;Cmd);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#ab9155734cbe51b26d62afa66f5952db8">UnlinkAll</a>) unlink(CImeta.Source);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">/* see if I need to spawn (if not, then save time by not!) */</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildEnd == 1) &amp;&amp; <a class="code" href="../../dc/d72/wc__agent_8c.html#a22009aec802ada7c638401a40d40775c">IsFile</a>(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,0))</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">goto</span> TraverseEnd;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">/* spawn unpacker */</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    fflush(stdout); <span class="comment">/* if no flush, then child may duplicate output! */</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>) fflush(<a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (RecurseOk)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      Pid = fork();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordflow">if</span> (Pid == 0) <a class="code" href="../../dc/d51/traverse_8c.html#a85f808829ada5223b092deca6de501c6">TraverseChild</a>(Index,&amp;CI,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="comment">/* Parent: Save child info */</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (Pid == -1)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          LOG_FATAL(<span class="stringliteral">&quot;Unable to fork child.&quot;</span>)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#ac78bfb98ca0076b2346b17dbcdb2d018">SafeExit</a>(33);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildPid = Pid;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="comment">// add by larry, start</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a891fad50d559c4e862f50f955bc5a84e">uploadtree_pk</a>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">// add by larry, end</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <a class="code" href="../../d2/df2/externs_8h.html#a62bf0d27b8b3271ef442671a33ca2324">Thread</a>++;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">/* Parent: Continue testing files */</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#a62bf0d27b8b3271ef442671a33ca2324">Thread</a> &gt;= <a class="code" href="../../d2/df2/externs_8h.html#a1c41cdeec6c1cec819e816d1adada13b">MaxThread</a>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          <span class="comment">/* Too many children.  Wait for one to end */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          Index=<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a64b8c43c00c946ec722013356a4f0abc">ParentWait</a>();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          <span class="keywordflow">if</span> (Index &lt; 0) <span class="keywordflow">goto</span> TraverseEnd; <span class="comment">/* no more children (shouldn&#39;t happen here!) */</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <a class="code" href="../../d2/df2/externs_8h.html#a62bf0d27b8b3271ef442671a33ca2324">Thread</a>--;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          <span class="comment">/* the value for ChildRecurse can/will be overwitten quickly, but</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">       it will be overwritten AFTER it is used */</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          <span class="comment">/* Only recurse if the name is different */</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">if</span> (strcmp(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,CI.Source) &amp;&amp; !<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a5658af09fefa20ae5a0a3ac94067c281">ChildEnd</a>)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="comment">/* copy over data */</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeff8656da5f07d8c98718b09b54c201d">Corrupt</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a6f8c4cb8542d168e395ac167fa121cf0">ChildCorrupt</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">StartTime</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">EndTime</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">EndTime</a>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a983502a85b09cc9d038adb6791de67dd">ChildHasChild</a>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">Stat</a> = <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a2fbb06cc24e648b4ad39c31247428c64">ChildStat</a>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].<a class="code" href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">PI</a>.<a class="code" href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">uploadtree_pk</a> = CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a891fad50d559c4e862f50f955bc5a84e">uploadtree_pk</a>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a> &gt; 0)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;              <a class="code" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a>(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,NULL,<span class="stringliteral">&quot;Called by dir/wait&quot;</span>,NULL,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>-1,&amp;<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].PI, ExcludePatterns);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a> &lt; 0)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;              <a class="code" href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a>(<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].ChildRecurse,NULL,<span class="stringliteral">&quot;Called by dir/wait&quot;</span>,NULL,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>,&amp;<a class="code" href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a>[Index].PI, ExcludePatterns);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;              fputs(<span class="stringliteral">&quot;&lt;/item&gt;\n&quot;</span>,<a class="code" href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a>);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;              <a class="code" href="../../d2/df2/externs_8h.html#a8e733e1bcf56b0c075de0d6c317c9c6f">TotalContainers</a>++;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        } <span class="comment">/* if waiting for a child */</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      } <span class="comment">/* if parent */</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    } <span class="comment">/* if RecurseOk */</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  } <span class="comment">/* if S_ISREG() */</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">  /***********************************************/</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">/* Not a file and not a directory */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (PI-&gt;Cmd)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      CI.<a class="code" href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">HasChild</a> = 0;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a>(&amp;CI,PI-&gt;Cmd);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    LOG_DEBUG(<span class="stringliteral">&quot;Skipping (not a file or directory): %s&quot;</span>,CI.Source)</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  TraverseEnd:</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d2/df2/externs_8h.html#ab9155734cbe51b26d62afa66f5952db8">UnlinkAll</a> &amp;&amp; <a class="code" href="../../d2/df2/externs_8h.html#a1c41cdeec6c1cec819e816d1adada13b">MaxThread</a> &lt;=1)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    printf(<span class="stringliteral">&quot;===\n&quot;</span>);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    printf(<span class="stringliteral">&quot;Source: &#39;%s&#39;\n&quot;</span>,CI.Source);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    printf(<span class="stringliteral">&quot;NewDir: &#39;%s&#39;\n&quot;</span>,<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> ? <a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    printf(<span class="stringliteral">&quot;Name: &#39;%s&#39;  &#39;%s&#39;\n&quot;</span>,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">Partdir</a>,CI.<a class="code" href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">Partname</a>);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#aff24afc956c8b7c00247758f99b2c55d">IsDir</a>(CI.Source)) <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a12c49e113cf48625b240ec7cc92bc7bf">RemoveDir</a>(CI.Source);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="comment">//    else unlink(CI.Source);</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="../../da/dd1/ununpack_2agent_2utils_8c.html#a12c49e113cf48625b240ec7cc92bc7bf">RemoveDir</a>(<a class="code" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">return</span>(IsContainer);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;} <span class="comment">/* Traverse() */</span></div>
<div class="ttc" id="aadj2nest_8c_html_a73bce74dcfe7784891254a9c63d2f526"><div class="ttname"><a href="../../dd/d9a/adj2nest_8c.html#a73bce74dcfe7784891254a9c63d2f526">SQL</a></div><div class="ttdeci">char SQL[256]</div><div class="ttdoc">SQL query to execute.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d9a/adj2nest_8c_source.html#l00078">adj2nest.c:78</a></div></div>
<div class="ttc" id="aadj2nest_8c_html_a7444694163584e990af192a7b4f9dddc"><div class="ttname"><a href="../../dd/d9a/adj2nest_8c.html#a7444694163584e990af192a7b4f9dddc">pgConn</a></div><div class="ttdeci">PGconn * pgConn</div><div class="ttdoc">Database connection.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d9a/adj2nest_8c_source.html#l00086">adj2nest.c:86</a></div></div>
<div class="ttc" id="adelagent_2agent_2util_8c_html_a95f627d7054b1abbffa2c6ea19bf05db"><div class="ttname"><a href="../../d7/de7/delagent_2agent_2util_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a></div><div class="ttdeci">int Verbose</div><div class="ttdoc">Verbose level.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de7/delagent_2agent_2util_8c_source.html#l00019">util.c:19</a></div></div>
<div class="ttc" id="aexterns_8h_html"><div class="ttname"><a href="../../d2/df2/externs_8h.html">externs.h</a></div><div class="ttdoc">Stores all extern variables used by the agent.</div></div>
<div class="ttc" id="aexterns_8h_html_a06bdfab0e4aebb0f085344b9af5d4f79"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a06bdfab0e4aebb0f085344b9af5d4f79">Pfile_Pk</a></div><div class="ttdeci">char * Pfile_Pk</div><div class="ttdoc">Pfile pk in DB.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00041">ununpack_globals.h:41</a></div></div>
<div class="ttc" id="aexterns_8h_html_a0e1e0eb803a25bb515c8560260161fcf"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a0e1e0eb803a25bb515c8560260161fcf">UseRepository</a></div><div class="ttdeci">int UseRepository</div><div class="ttdoc">Using files from the repository?</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00033">ununpack_globals.h:33</a></div></div>
<div class="ttc" id="aexterns_8h_html_a1c41cdeec6c1cec819e816d1adada13b"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a1c41cdeec6c1cec819e816d1adada13b">MaxThread</a></div><div class="ttdeci">int MaxThread</div><div class="ttdoc">Value between 1 and MAXCHILD.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00050">ununpack_globals.h:50</a></div></div>
<div class="ttc" id="aexterns_8h_html_a1d4b244022f10811f764dfa2691a3f60"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a1d4b244022f10811f764dfa2691a3f60">UnlinkSource</a></div><div class="ttdeci">int UnlinkSource</div><div class="ttdoc">Remove recursive sources after unpacking?</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00022">ununpack_globals.h:22</a></div></div>
<div class="ttc" id="aexterns_8h_html_a3492f580028938e4d39f166a0e98354f"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a3492f580028938e4d39f166a0e98354f">Queue</a></div><div class="ttdeci">unpackqueue Queue[MAXCHILD+1]</div><div class="ttdoc">Manage children.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00049">ununpack_globals.h:49</a></div></div>
<div class="ttc" id="aexterns_8h_html_a62bf0d27b8b3271ef442671a33ca2324"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a62bf0d27b8b3271ef442671a33ca2324">Thread</a></div><div class="ttdeci">int Thread</div><div class="ttdoc">Number of threads in execution.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00051">ununpack_globals.h:51</a></div></div>
<div class="ttc" id="aexterns_8h_html_a77d90e7c1e289b0ad32c037f6c3f7572"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a77d90e7c1e289b0ad32c037f6c3f7572">CMD</a></div><div class="ttdeci">cmdlist CMD[]</div><div class="ttdoc">Global command table.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00062">ununpack_globals.h:62</a></div></div>
<div class="ttc" id="aexterns_8h_html_a8a79461093fd4ed01d5a021a4fc7c66f"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a8a79461093fd4ed01d5a021a4fc7c66f">PruneFiles</a></div><div class="ttdeci">int PruneFiles</div><div class="ttdoc">Remove links? &gt;1 hard links, zero files, etc.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00026">ununpack_globals.h:26</a></div></div>
<div class="ttc" id="aexterns_8h_html_a8e733e1bcf56b0c075de0d6c317c9c6f"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a8e733e1bcf56b0c075de0d6c317c9c6f">TotalContainers</a></div><div class="ttdeci">int TotalContainers</div><div class="ttdoc">Number of containers.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00058">ununpack_globals.h:58</a></div></div>
<div class="ttc" id="aexterns_8h_html_a9065b9f1c1715bc048058d9bb8263a8f"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a9065b9f1c1715bc048058d9bb8263a8f">UploadFileName</a></div><div class="ttdeci">char UploadFileName[FILENAME_MAX]</div><div class="ttdoc">Upload file name.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00037">ununpack_globals.h:37</a></div></div>
<div class="ttc" id="aexterns_8h_html_a96101cadb5f5bcad1215b7c40600e03e"><div class="ttname"><a href="../../d2/df2/externs_8h.html#a96101cadb5f5bcad1215b7c40600e03e">Upload_Pk</a></div><div class="ttdeci">char * Upload_Pk</div><div class="ttdoc">Upload pk in DB.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00042">ununpack_globals.h:42</a></div></div>
<div class="ttc" id="aexterns_8h_html_ab9155734cbe51b26d62afa66f5952db8"><div class="ttname"><a href="../../d2/df2/externs_8h.html#ab9155734cbe51b26d62afa66f5952db8">UnlinkAll</a></div><div class="ttdeci">int UnlinkAll</div><div class="ttdoc">Remove ALL unpacked files when done (clean up)?</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00023">ununpack_globals.h:23</a></div></div>
<div class="ttc" id="aexterns_8h_html_acb94873f63e4957eeb3e1a7429598084"><div class="ttname"><a href="../../d2/df2/externs_8h.html#acb94873f63e4957eeb3e1a7429598084">ListOutFile</a></div><div class="ttdeci">FILE * ListOutFile</div><div class="ttdoc">File to store unpack list.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00028">ununpack_globals.h:28</a></div></div>
<div class="ttc" id="aexterns_8h_html_afbe2b0bbc145212ed3974fcdd2eb207a"><div class="ttname"><a href="../../d2/df2/externs_8h.html#afbe2b0bbc145212ed3974fcdd2eb207a">ForceContinue</a></div><div class="ttdeci">int ForceContinue</div><div class="ttdoc">Force continue when unpack tool fails?</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da7/ununpack__globals_8h_source.html#l00024">ununpack_globals.h:24</a></div></div>
<div class="ttc" id="alibfossdb_8c_html_a438acf56cee347de51d91e1afe2de97d"><div class="ttname"><a href="../../d1/d54/libfossdb_8c.html#a438acf56cee347de51d91e1afe2de97d">fo_checkPQresult</a></div><div class="ttdeci">int fo_checkPQresult(PGconn *pgConn, PGresult *result, char *sql, char *FileID, int LineNumb)</div><div class="ttdoc">Check the result status of a postgres SELECT.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d54/libfossdb_8c_source.html#l00170">libfossdb.c:170</a></div></div>
<div class="ttc" id="arepcopyin_8c_html_a16ebffeb9cbd186c1170f284e719dbb3"><div class="ttname"><a href="../../d1/da6/repcopyin_8c.html#a16ebffeb9cbd186c1170f284e719dbb3">CopyFile</a></div><div class="ttdeci">void CopyFile(char *Source, char *Type, char *Name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da6/repcopyin_8c_source.html#l00039">repcopyin.c:39</a></div></div>
<div class="ttc" id="astructContainerInfo_html"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html">ContainerInfo</a></div><div class="ttdoc">Structure for storing information about a particular file.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00115">ununpack.h:116</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a061e6987f5563a6fd0aa98822bda4db0"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a061e6987f5563a6fd0aa98822bda4db0">ContainerInfo::IsDir</a></div><div class="ttdeci">int IsDir</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00128">ununpack.h:128</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a0fb8f628d00d1b4b3765f22799321f15"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a0fb8f628d00d1b4b3765f22799321f15">ContainerInfo::Artifact</a></div><div class="ttdeci">int Artifact</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00127">ununpack.h:127</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a16753df28705ba45c82870227e33b3a0"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a16753df28705ba45c82870227e33b3a0">ContainerInfo::IsCompressed</a></div><div class="ttdeci">int IsCompressed</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00129">ununpack.h:129</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a3300195cb6a40044a95f2b04f3e27c29"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a3300195cb6a40044a95f2b04f3e27c29">ContainerInfo::TopContainer</a></div><div class="ttdeci">int TopContainer</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00121">ununpack.h:121</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a46d99f8ca987e5152a72d95debd6e878"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a46d99f8ca987e5152a72d95debd6e878">ContainerInfo::PI</a></div><div class="ttdeci">ParentInfo PI</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00126">ununpack.h:126</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a74b5c59938ac55154b42d7a8ed6cb840"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a74b5c59938ac55154b42d7a8ed6cb840">ContainerInfo::Partname</a></div><div class="ttdeci">char Partname[FILENAME_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00119">ununpack.h:119</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a77b8b029763ac83e763135a6554a88b5"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a77b8b029763ac83e763135a6554a88b5">ContainerInfo::Pruned</a></div><div class="ttdeci">int Pruned</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00123">ununpack.h:123</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a891fad50d559c4e862f50f955bc5a84e"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a891fad50d559c4e862f50f955bc5a84e">ContainerInfo::uploadtree_pk</a></div><div class="ttdeci">long uploadtree_pk</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00130">ununpack.h:130</a></div></div>
<div class="ttc" id="astructContainerInfo_html_a9526b526d746dd6682e34865a116fbe4"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#a9526b526d746dd6682e34865a116fbe4">ContainerInfo::Stat</a></div><div class="ttdeci">struct stat Stat</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00124">ununpack.h:125</a></div></div>
<div class="ttc" id="astructContainerInfo_html_aaae460f7cff313389bc43f46f49ee7c3"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#aaae460f7cff313389bc43f46f49ee7c3">ContainerInfo::PartnameNew</a></div><div class="ttdeci">char PartnameNew[FILENAME_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00120">ununpack.h:120</a></div></div>
<div class="ttc" id="astructContainerInfo_html_ae80c632dd53ce847bfea68c55a6f4a06"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#ae80c632dd53ce847bfea68c55a6f4a06">ContainerInfo::Partdir</a></div><div class="ttdeci">char Partdir[FILENAME_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00118">ununpack.h:118</a></div></div>
<div class="ttc" id="astructContainerInfo_html_aeb6b129b184891358de8973a0fd9e435"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#aeb6b129b184891358de8973a0fd9e435">ContainerInfo::HasChild</a></div><div class="ttdeci">int HasChild</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00122">ununpack.h:122</a></div></div>
<div class="ttc" id="astructContainerInfo_html_aeff8656da5f07d8c98718b09b54c201d"><div class="ttname"><a href="../../d8/db7/structContainerInfo.html#aeff8656da5f07d8c98718b09b54c201d">ContainerInfo::Corrupt</a></div><div class="ttdeci">int Corrupt</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00124">ununpack.h:124</a></div></div>
<div class="ttc" id="astructParentInfo_html"><div class="ttname"><a href="../../d3/dbf/structParentInfo.html">ParentInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00075">ununpack.h:76</a></div></div>
<div class="ttc" id="astructParentInfo_html_a034d73e5511b9581fb506114382d64ae"><div class="ttname"><a href="../../d3/dbf/structParentInfo.html#a034d73e5511b9581fb506114382d64ae">ParentInfo::StartTime</a></div><div class="ttdeci">time_t StartTime</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00078">ununpack.h:78</a></div></div>
<div class="ttc" id="astructParentInfo_html_a1bd4e32d6c52fc62f68a0b342984bbd7"><div class="ttname"><a href="../../d3/dbf/structParentInfo.html#a1bd4e32d6c52fc62f68a0b342984bbd7">ParentInfo::uploadtree_pk</a></div><div class="ttdeci">long uploadtree_pk</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00081">ununpack.h:81</a></div></div>
<div class="ttc" id="astructParentInfo_html_a9e4b0974815345e60bcc6a304e7c874d"><div class="ttname"><a href="../../d3/dbf/structParentInfo.html#a9e4b0974815345e60bcc6a304e7c874d">ParentInfo::ChildRecurseArtifact</a></div><div class="ttdeci">int ChildRecurseArtifact</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00080">ununpack.h:80</a></div></div>
<div class="ttc" id="astructParentInfo_html_ab441ea77f6a479c5807fa90336fea8cd"><div class="ttname"><a href="../../d3/dbf/structParentInfo.html#ab441ea77f6a479c5807fa90336fea8cd">ParentInfo::EndTime</a></div><div class="ttdeci">time_t EndTime</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00079">ununpack.h:79</a></div></div>
<div class="ttc" id="astructcmdlist_html_a28275c85935dbab4ab3e37d38590d59b"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#a28275c85935dbab4ab3e37d38590d59b">cmdlist::Type</a></div><div class="ttdeci">cmdtype Type</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00149">ununpack.h:149</a></div></div>
<div class="ttc" id="astructcmdlist_html_a3afc29fb861af74db4407d373adab9df"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#a3afc29fb861af74db4407d373adab9df">cmdlist::Status</a></div><div class="ttdeci">int Status</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00150">ununpack.h:150</a></div></div>
<div class="ttc" id="astructcmdlist_html_a52152df8214439058f322d1df401bd46"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#a52152df8214439058f322d1df401bd46">cmdlist::MetaCmd</a></div><div class="ttdeci">char * MetaCmd</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00148">ununpack.h:148</a></div></div>
<div class="ttc" id="astructcmdlist_html_a5d6bc41547760ad1a665bb4d23203181"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#a5d6bc41547760ad1a665bb4d23203181">cmdlist::Cmd</a></div><div class="ttdeci">char * Cmd</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00145">ununpack.h:145</a></div></div>
<div class="ttc" id="astructcmdlist_html_aca62b31c4db91db7d4bcb0b83e72c300"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#aca62b31c4db91db7d4bcb0b83e72c300">cmdlist::CmdPost</a></div><div class="ttdeci">char * CmdPost</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00147">ununpack.h:147</a></div></div>
<div class="ttc" id="astructcmdlist_html_ae923a3cb4c42188ac5441cc4d7dd6252"><div class="ttname"><a href="../../d4/d71/structcmdlist.html#ae923a3cb4c42188ac5441cc4d7dd6252">cmdlist::CmdPre</a></div><div class="ttdeci">char * CmdPre</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00146">ununpack.h:146</a></div></div>
<div class="ttc" id="astructdirlist_html"><div class="ttname"><a href="../../df/d8d/structdirlist.html">dirlist</a></div><div class="ttdoc">Directory linked list.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00104">ununpack.h:105</a></div></div>
<div class="ttc" id="astructdirlist_html_a0a4355653fb6ded7a8f9736fc157a2a4"><div class="ttname"><a href="../../df/d8d/structdirlist.html#a0a4355653fb6ded7a8f9736fc157a2a4">dirlist::Next</a></div><div class="ttdeci">struct dirlist * Next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00107">ununpack.h:107</a></div></div>
<div class="ttc" id="astructunpackqueue_html"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html">unpackqueue</a></div><div class="ttdoc">Queue for files to be unpacked.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00088">ununpack.h:89</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a21237274667a225d99b525008f128999"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a21237274667a225d99b525008f128999">unpackqueue::PI</a></div><div class="ttdeci">ParentInfo PI</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00097">ununpack.h:97</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a2fbb06cc24e648b4ad39c31247428c64"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a2fbb06cc24e648b4ad39c31247428c64">unpackqueue::ChildStat</a></div><div class="ttdeci">struct stat ChildStat</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00095">ununpack.h:96</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a5658af09fefa20ae5a0a3ac94067c281"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a5658af09fefa20ae5a0a3ac94067c281">unpackqueue::ChildEnd</a></div><div class="ttdeci">int ChildEnd</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00094">ununpack.h:94</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a65edb6f84c5e0564b77b9c2c0edb732b"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a65edb6f84c5e0564b77b9c2c0edb732b">unpackqueue::ChildRecurse</a></div><div class="ttdeci">char ChildRecurse[FILENAME_MAX+1]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00091">ununpack.h:91</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a6f8c4cb8542d168e395ac167fa121cf0"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a6f8c4cb8542d168e395ac167fa121cf0">unpackqueue::ChildCorrupt</a></div><div class="ttdeci">int ChildCorrupt</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00093">ununpack.h:93</a></div></div>
<div class="ttc" id="astructunpackqueue_html_a983502a85b09cc9d038adb6791de67dd"><div class="ttname"><a href="../../d6/d06/structunpackqueue.html#a983502a85b09cc9d038adb6791de67dd">unpackqueue::ChildHasChild</a></div><div class="ttdeci">int ChildHasChild</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d3f/ununpack_8h_source.html#l00095">ununpack.h:95</a></div></div>
<div class="ttc" id="atest__CopyFile_8c_html_ab9e3da739cc5709282a49940edec2d6b"><div class="ttname"><a href="../../d2/d7b/test__CopyFile_8c.html#ab9e3da739cc5709282a49940edec2d6b">Dst</a></div><div class="ttdeci">static char * Dst</div><div class="ttdoc">Destination location.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d7b/test__CopyFile_8c_source.html#l00014">test_CopyFile.c:14</a></div></div>
<div class="ttc" id="atest__CopyFile_8c_html_af16413f3af1abd6bf7646374bf12f672"><div class="ttname"><a href="../../d2/d7b/test__CopyFile_8c.html#af16413f3af1abd6bf7646374bf12f672">Src</a></div><div class="ttdeci">static char * Src</div><div class="ttdoc">Souce location.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d7b/test__CopyFile_8c_source.html#l00013">test_CopyFile.c:13</a></div></div>
<div class="ttc" id="atraverse_8c_html_a046fc4e1094b61c75af58061b57a6d64"><div class="ttname"><a href="../../dc/d51/traverse_8c.html#a046fc4e1094b61c75af58061b57a6d64">TraverseStart</a></div><div class="ttdeci">void TraverseStart(char *Filename, char *Label, char *NewDir, int Recurse, char *ExcludePatterns)</div><div class="ttdoc">Find all files (assuming a directory) and process (unpack) all of them.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d51/traverse_8c_source.html#l00024">traverse.c:24</a></div></div>
<div class="ttc" id="atraverse_8c_html_a5a0ed04e29704b6829ae0f4533cf4ebb"><div class="ttname"><a href="../../dc/d51/traverse_8c.html#a5a0ed04e29704b6829ae0f4533cf4ebb">CountFilename</a></div><div class="ttdeci">int CountFilename(char *Pathname, char *Dirname)</div><div class="ttdoc">Count the number of times Dirname appears in Pathname This is used to limit recursion in test archive...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d51/traverse_8c_source.html#l00238">traverse.c:238</a></div></div>
<div class="ttc" id="atraverse_8c_html_a85f808829ada5223b092deca6de501c6"><div class="ttname"><a href="../../dc/d51/traverse_8c.html#a85f808829ada5223b092deca6de501c6">TraverseChild</a></div><div class="ttdeci">void TraverseChild(int Index, ContainerInfo *CI, char *NewDir)</div><div class="ttdoc">Called by exec'd child to process.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d51/traverse_8c_source.html#l00096">traverse.c:96</a></div></div>
<div class="ttc" id="atraverse_8c_html_acd3de62fde8978243cc78bd2e90a7807"><div class="ttname"><a href="../../dc/d51/traverse_8c.html#acd3de62fde8978243cc78bd2e90a7807">Traverse</a></div><div class="ttdeci">int Traverse(char *Filename, char *Basename, char *Label, char *NewDir, int Recurse, ParentInfo *PI, char *ExcludePatterns)</div><div class="ttdoc">Find all files, traverse all directories. This is a depth-first search, in inode order!</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d51/traverse_8c_source.html#l00275">traverse.c:275</a></div></div>
<div class="ttc" id="aununpack-ar_8c_html_ae9b5ed248989dc8062b9f7f13d153f7a"><div class="ttname"><a href="../../da/dc9/ununpack-ar_8c.html#ae9b5ed248989dc8062b9f7f13d153f7a">ExtractAR</a></div><div class="ttdeci">int ExtractAR(char *Source, char *Destination)</div><div class="ttdoc">Given an AR file, extract the contents to the directory. This uses the command ar.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc9/ununpack-ar_8c_source.html#l00026">ununpack-ar.c:26</a></div></div>
<div class="ttc" id="aununpack-disk_8c_html_a45f3002c753d25020be58733213ce62c"><div class="ttname"><a href="../../dd/df0/ununpack-disk_8c.html#a45f3002c753d25020be58733213ce62c">ExtractDisk</a></div><div class="ttdeci">int ExtractDisk(char *Source, char *FStype, char *Destination)</div><div class="ttdoc">Given a disk image, type of system, and a directory, extract all files!</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df0/ununpack-disk_8c_source.html#l00288">ununpack-disk.c:288</a></div></div>
<div class="ttc" id="aununpack-iso_8c_html_a44bb9c4d80d984b566d5e3623abfdf41"><div class="ttname"><a href="../../d7/df3/ununpack-iso_8c.html#a44bb9c4d80d984b566d5e3623abfdf41">ExtractISO</a></div><div class="ttdeci">int ExtractISO(char *Source, char *Destination)</div><div class="ttdoc">Given an ISO image and a directory, extract the image to the directory.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df3/ununpack-iso_8c_source.html#l00068">ununpack-iso.c:68</a></div></div>
<div class="ttc" id="aununpack-zstd_8c_html_aff5a2738c264d906825abe7eacefcb7e"><div class="ttname"><a href="../../dd/de8/ununpack-zstd_8c.html#aff5a2738c264d906825abe7eacefcb7e">ExtractZstd</a></div><div class="ttdeci">int ExtractZstd(char *Source, const char *OrigName, char *Destination)</div><div class="ttdoc">Given a ZSTd file, extract the contents to the directory.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de8/ununpack-zstd_8c_source.html#l00023">ununpack-zstd.c:23</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a0688c932b008471183a29139b4f95678"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0688c932b008471183a29139b4f95678">RunCommand</a></div><div class="ttdeci">int RunCommand(char *Cmd, char *CmdPre, char *File, char *CmdPost, char *Out, char *Where)</div><div class="ttdoc">Try a command and return command code.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00622">utils.c:622</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a0f8e71c19a3bd44c8c5137dea88ad097"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a0f8e71c19a3bd44c8c5137dea88ad097">DisplayContainerInfo</a></div><div class="ttdeci">int DisplayContainerInfo(ContainerInfo *CI, int Cmd)</div><div class="ttdoc">Print what can be printed in XML.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l01458">utils.c:1458</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a12c49e113cf48625b240ec7cc92bc7bf"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a12c49e113cf48625b240ec7cc92bc7bf">RemoveDir</a></div><div class="ttdeci">int RemoveDir(char *dirpath)</div><div class="ttdoc">Remove all files under dirpath (rm -rf)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l01642">utils.c:1642</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a2020639c7c03622a929b1cc72d9a06fb"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a2020639c7c03622a929b1cc72d9a06fb">Prune</a></div><div class="ttdeci">int Prune(char *Fname, struct stat Stat)</div><div class="ttdoc">Given a filename and its stat, prune it.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00218">utils.c:218</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a448bdbe43cd0c6546080a43d040d6459"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a448bdbe43cd0c6546080a43d040d6459">MkDir</a></div><div class="ttdeci">int MkDir(char *Fname)</div><div class="ttdoc">Smart mkdir.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00304">utils.c:304</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a55da88b45401fd659b99672a6d7bc063"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a55da88b45401fd659b99672a6d7bc063">SetDir</a></div><div class="ttdeci">void SetDir(char *Dest, int DestLen, char *Smain, char *Sfile)</div><div class="ttdoc">Set a destination directory name.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l01048">utils.c:1048</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a64b8c43c00c946ec722013356a4f0abc"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a64b8c43c00c946ec722013356a4f0abc">ParentWait</a></div><div class="ttdeci">int ParentWait()</div><div class="ttdoc">Wait for a child. Sets child status.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00510">utils.c:510</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a6e479dbd33c75d4a9638fd6b2834f0b3"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a6e479dbd33c75d4a9638fd6b2834f0b3">RemovePostfix</a></div><div class="ttdeci">void RemovePostfix(char *Name)</div><div class="ttdoc">get rid of the postfix</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00091">utils.c:91</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_a8cae8a17fc2bf4506f01b1fe34a27ae7"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#a8cae8a17fc2bf4506f01b1fe34a27ae7">FreeDirList</a></div><div class="ttdeci">void FreeDirList(dirlist *DL)</div><div class="ttdoc">Free a list of files in a directory list.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00952">utils.c:952</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_ac78bfb98ca0076b2346b17dbcdb2d018"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#ac78bfb98ca0076b2346b17dbcdb2d018">SafeExit</a></div><div class="ttdeci">void SafeExit(int rc)</div><div class="ttdoc">Close scheduler and database connections, then exit.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00078">utils.c:78</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_acc07c877878c2fb76b859399bdab6e3a"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#acc07c877878c2fb76b859399bdab6e3a">FindCmd</a></div><div class="ttdeci">int FindCmd(char *Filename)</div><div class="ttdoc">Given a file name, determine the type of extraction command. This uses Magic.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00851">utils.c:851</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_ace54f405f5bb845211785673bf1f730c"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#ace54f405f5bb845211785673bf1f730c">ShouldExclude</a></div><div class="ttdeci">int ShouldExclude(char *Filename, const char *ExcludePatterns)</div><div class="ttdoc">Determines if a file or folder should be excluded.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l01788">utils.c:1788</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_ad3f39d9f28b78932107203b1e6250828"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#ad3f39d9f28b78932107203b1e6250828">IsInflatedFile</a></div><div class="ttdeci">int IsInflatedFile(char *FileName, int InflateSize)</div><div class="ttdoc">Test if the file is a compression bomb.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00041">utils.c:41</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_aee9a4674a7cf791d89b2cd3133867ad5"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#aee9a4674a7cf791d89b2cd3133867ad5">MakeDirList</a></div><div class="ttdeci">dirlist * MakeDirList(char *Fullname)</div><div class="ttdoc">Create a list of files in a directory.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00971">utils.c:971</a></div></div>
<div class="ttc" id="aununpack_2agent_2utils_8c_html_aff24afc956c8b7c00247758f99b2c55d"><div class="ttname"><a href="../../da/dd1/ununpack_2agent_2utils_8c.html#aff24afc956c8b7c00247758f99b2c55d">IsDir</a></div><div class="ttdeci">int IsDir(char *Fname)</div><div class="ttdoc">Given a filename, is it a directory?</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd1/ununpack_2agent_2utils_8c_source.html#l00320">utils.c:320</a></div></div>
<div class="ttc" id="aununpack_2agent__tests_2Unit_2run__tests_8c_html_a5fa2363035a6f16330f4adf196c08e2c"><div class="ttname"><a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a></div><div class="ttdeci">int Recurse</div><div class="ttdoc">Level of unpack recursion. Default to infinite.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c_source.html#l00019">run_tests.c:19</a></div></div>
<div class="ttc" id="aununpack_2agent__tests_2Unit_2run__tests_8c_html_a81115b7f9bc83e19bd414c35eae6ac83"><div class="ttname"><a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a></div><div class="ttdeci">char * NewDir</div><div class="ttdoc">Test result directory.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c_source.html#l00018">run_tests.c:18</a></div></div>
<div class="ttc" id="aununpack_2agent__tests_2Unit_2run__tests_8c_html_a8f91fce8713dd601ee00a5fcef69c9c7"><div class="ttname"><a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a></div><div class="ttdeci">char * Filename</div><div class="ttdoc">Filename.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c_source.html#l00017">run_tests.c:17</a></div></div>
<div class="ttc" id="awc__agent_8c_html_a22009aec802ada7c638401a40d40775c"><div class="ttname"><a href="../../dc/d72/wc__agent_8c.html#a22009aec802ada7c638401a40d40775c">IsFile</a></div><div class="ttdeci">int IsFile(long mode)</div><div class="ttdoc">Check if the pfile_id is a file.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d72/wc__agent_8c_source.html#l00055">wc_agent.c:55</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_5f27d04085cf5632b5250e7d720a5094.html">ununpack</a></li><li class="navelem"><a class="el" href="../../dir_0ac331944ea22858c41867ea753814de.html">agent</a></li><li class="navelem"><a class="el" href="../../dc/d51/traverse_8c.html">traverse.c</a></li>
    <li class="footer">Generated on Wed Oct 29 2025 10:31:30 for FOSSology by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
